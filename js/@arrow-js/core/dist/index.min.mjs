const e=new Set,n=new Set;function c(c){if(!e.size)return c&&c(),Promise.resolve();let s;const u=new Promise((r=>{s=r}));return n.add((()=>{c&&c(),s()})),u}function s(e){return"function"==typeof e&&!!e.isT}function u(e){return"object"==typeof e&&null!==e&&"$on"in e&&"function"==typeof e.$on}function a(e){return"$on"in e}function i(c){return(s,u)=>{e.size||setTimeout((function c(){const a=Array.from(e);e.clear();const i=Array.from(n);n.clear(),a.forEach((e=>e(s,u))),i.forEach((e=>e())),e.size&&setTimeout(c)})),e.add(c)}}const l={},f=new Map;function r(e,n={}){if(u(e)||"object"!=typeof e)return e;const c=n.o||new Map,s=n.op||new Map,a=Array.isArray(e),i=[],l=a?[]:Object.create(e,{});for(const n in e){const c=e[n];"object"==typeof c&&null!==c?(l[n]=u(c)?c:r(c),i.push(n)):l[n]=c}const f=e=>(n,u)=>{let a=c.get(n),i=s.get(u);a||(a=new Set,c.set(n,a)),i||(i=new Set,s.set(u,i)),a[e](u),i[e](n)},$on=f("add"),$off=f("delete"),_em=(e,n,s)=>{c.has(e)&&c.get(e).forEach((e=>e(n,s)))},m={$on,$off,_em,_st:()=>({o:c,op:s,r:l,p:g._p}),_p:void 0},g=new Proxy(l,{has:(e,key)=>key in m||key in e,get(...e){const[,n]=e;if(Reflect.has(m,n))return Reflect.get(m,n);const c=Reflect.get(...e);return p(g,n),a&&n in Array.prototype?d(n,l,g,c):c},set(...e){const[n,c,s]=e,a=Reflect.get(n,c);if(Reflect.has(m,c))return Reflect.set(m,c,s);if(s&&u(a)){const o=a,e=o._st(),i=u(s)?h(s,o):r(s,e);return Reflect.set(n,c,i),_em(c,i),e.o.forEach(((e,n)=>{const c=Reflect.get(a,n),s=Reflect.get(i,n);c!==s&&o._em(n,s,c)})),!0}const i=Reflect.set(...e);return i&&(a!==s&&_em(c,s,a),g._p&&g._p[1]._em(...g._p)),i}});return n.p&&(g._p=n.p),i.map((e=>{g[e]._p=[e,g]})),g}function p(e,n){f.forEach((c=>{let s=c.get(e);s||(s=new Set,c.set(e,s)),s.add(n)}))}function d(op,e,n,c){const s=(...c)=>{const s=Array.prototype[op].call(e,...c);if(e.forEach(((e,c)=>n._em(String(c),e))),n._p){const[e,c]=n._p;c._em(e,n)}return s};switch(op){case"shift":case"pop":case"sort":case"reverse":case"copyWithin":return s;case"unshift":case"push":case"fill":return(...e)=>s(...e.map((e=>r(e))));case"splice":return(e,n,...c)=>s(e,n,...c.map((e=>r(e))));default:return c}}function h(e,n){const c=n._st();return c.o&&c.o.forEach(((n,c)=>{n.forEach((n=>{e.$on(c,n)}))})),c.p&&(e._p=c.p),e}function m(e,n){const c=Symbol();f.has(c)||f.set(c,new Map);let s=new Map;const u=i(l);function l(){f.set(c,new Map);const a=e(),i=f.get(c);return f.delete(c),s.forEach(((e,n)=>{const c=i.get(n);c&&c.forEach((n=>e.delete(n))),e.forEach((e=>n.$off(e,u)))})),i.forEach(((e,n)=>{e.forEach((e=>n.$on(e,u)))})),s=i,n?n(a):a}return a(e)&&e.$on(l),l()}const g=new WeakMap,y={},E="➳❍",_="❍⇚",v=`\x3c!--${E}--\x3e`,x=`\x3c!--${_}--\x3e`;function t(e,...n){const c=[];let s="";const u=(e,html)=>{if("function"==typeof e){let n=()=>{};return c.push(Object.assign(((...n)=>e(...n)),{e,$on:e=>{n=e},_up:exp=>{e=exp,n()}})),html+v}return Array.isArray(e)?e.reduce(((html,exp)=>u(exp,html)),html):html+e},a=()=>(s||(s=n.length||1!==e.length||""!==e[0]?e.reduce((function(html,e,c){return html+=e,void 0!==n[c]?u(n[c],html):html}),""):"\x3c!----\x3e"),s),i=e=>{const n=b(S(a()),{i:0,e:c});return e?n(e):n()};return i.isT=!0,i._k=0,i._h=()=>[a(),c,i._k],i.key=key=>(i._k=key,i),i}function b(dom,e){const n=document.createDocumentFragment();let c;for(;c=dom.item(0);)8!==c.nodeType||c.nodeValue!==E?(c instanceof Element&&w(c,e),c.hasChildNodes()&&b(c.childNodes,e)(c),n.append(c),c instanceof HTMLOptionElement&&(c.selected=c.defaultSelected)):n.append(k(c,e));return e=>e?(e.appendChild(n),e):n}function w(e,n){var c;const s=[];let u,a=0;for(;u=e.attributes[a++];){if(n.i>=n.e.length)return;if(u.value!==v)continue;let i=u.name;const l=n.e[n.i++];if("@"===i.charAt(0)){const n=i.substring(1);e.addEventListener(n,l),g.has(e)||g.set(e,new Map),null===(c=g.get(e))||void 0===c||c.set(n,l),s.push(i)}else{const n="value"===i&&"value"in e||"checked"===i||i.startsWith(".")&&(i=i.substring(1));m(l,(c=>{n&&(e[i]=c,e.getAttribute(i)!=c&&(c=!1)),!1!==c?e.setAttribute(i,c):(e.removeAttribute(i),a--)}))}}s.forEach((n=>e.removeAttribute(n)))}function A(e){e.forEach($)}function $(e){var n;e.remove(),null===(n=g.get(e))||void 0===n||n.forEach(((n,c)=>e.removeEventListener(c,n)))}function k(e,n){const c=document.createDocumentFragment();e.remove();const u=n.e[n.i++];if(u&&s(u.e))c.appendChild(R().add(u.e)());else{let e;c.appendChild((e=m(u,(n=>M(n,e))))())}return c}function M(e,n){const c="function"==typeof n,s=c?n:R();return Array.isArray(e)?e.forEach((e=>s.add(e))):s.add(e),c&&s._up(),s}function S(html){var e;const dom=(null!==(e=y[html])&&void 0!==e?e:(()=>{const tpl=document.createElement("template");return tpl.innerHTML=html,y[html]=tpl})()).content.cloneNode(!0);return dom.normalize(),dom.childNodes}function R(e=Symbol()){let html="",n={i:0,e:[]},c=[],u=[];const a=new Map,i=[],l=()=>{let dom;if(c.length||p(),1!==c.length||s(c[0].tpl))dom=d(b(S(html),n)());else{const e=c[0];e.dom.length?e.dom[0].nodeValue=e.tpl:e.dom.push(document.createTextNode(e.tpl)),dom=e.dom[0]}return f(),dom};l.ch=()=>u,l.l=0,l.add=tpl=>{if(!tpl&&0!==tpl)return l;let key,e=[],u="";s(tpl)&&([u,e,key]=tpl._h()),html+=u,html+=x;const i=key&&a.get(key),f=i||{html:u,exp:e,dom:[],tpl,key};return c.push(f),key&&(i?i.exp.forEach(((exp,n)=>exp._up(e[n].e))):a.set(key,f)),n.e.push(...e),l.l++,l},l._up=()=>{const n=R(e);let s=0,a=u[0].dom[0];c.length||p(document.createComment(""));const l=()=>{if(!n.l)return;const e=n(),u=e.lastChild;a[s?"after":"before"](e),h(n,c,s),a=u};c.forEach(((e,c)=>{const f=u[c];e.key&&e.dom.length?(l(),f&&f.dom===e.dom||a[c?"after":"before"](...e.dom),a=e.dom[e.dom.length-1]):f&&e.html===f.html&&!f.key?(l(),f.exp.forEach(((n,c)=>n._up(e.exp[c].e))),e.exp=f.exp,e.dom=f.dom,a=e.dom[e.dom.length-1],T(e)&&a instanceof Text&&(a.nodeValue=e.tpl)):(f&&e.html!==f.html&&!f.key&&i.push(...f.dom),n.l||(s=c),n.add(e.tpl))})),l();let d=null==a?void 0:a.nextSibling;for(;d&&e in d;){i.push(d);d=d.nextSibling}A(i),f()};const f=()=>{i.length=0,html="",l.l=0,n={i:0,e:[]},u=[...c],c=[]},p=e=>{html="\x3c!----\x3e",c.push({html,exp:[],dom:e?[e]:[],tpl:t`${html}`,key:0})},d=n=>{let s=0;const u=[];return n.childNodes.forEach((n=>{if(8===n.nodeType&&n.data===_)return s++,void u.push(n);Object.defineProperty(n,e,{value:e}),c[s].dom.push(n)})),u.forEach((e=>e.remove())),n},h=(e,n,c)=>{e.ch().forEach(((e,s)=>{n[c+s].dom=e.dom}))};return l}function T(e){return 1===e.dom.length&&!s(e.tpl)}const html=t,j=r,C=m;export{html,l as measurements,c as nextTick,r,j as reactive,t,m as w,C as watch};
//# sourceMappingURL=index.min.js.map